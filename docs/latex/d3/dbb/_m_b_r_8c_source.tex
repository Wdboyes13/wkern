\doxysection{MBR.\+c}
\hypertarget{_m_b_r_8c_source}{}\label{_m_b_r_8c_source}\index{src/fileio/MBR.c@{src/fileio/MBR.c}}
\mbox{\hyperlink{_m_b_r_8c}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00001}00001\ \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00002}00002\ \textcolor{comment}{WKern\ -\/\ A\ Bare\ Metal\ OS\ /\ Kernel\ I\ am\ maKing\ (For\ Fun)}}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00003}00003\ \textcolor{comment}{Copyright\ (C)\ 2025\ \ Wdboyes13}}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00004}00004\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00005}00005\ \textcolor{comment}{This\ program\ is\ free\ software:\ you\ can\ redistribute\ it\ and/or\ modify}}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00006}00006\ \textcolor{comment}{it\ under\ the\ terms\ of\ the\ GNU\ General\ Public\ License\ as\ published\ by}}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00007}00007\ \textcolor{comment}{the\ Free\ Software\ Foundation,\ either\ version\ 3\ of\ the\ License,\ or}}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00008}00008\ \textcolor{comment}{any\ later\ version.}}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00009}00009\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00010}00010\ \textcolor{comment}{This\ program\ is\ distributed\ in\ the\ hope\ that\ it\ will\ be\ useful,}}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00011}00011\ \textcolor{comment}{but\ WITHOUT\ ANY\ WARRANTY;\ without\ even\ the\ implied\ warranty\ of}}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00012}00012\ \textcolor{comment}{MERCHANTABILITY\ or\ FITNESS\ FOR\ A\ PARTICULAR\ PURPOSE.\ \ See\ the}}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00013}00013\ \textcolor{comment}{GNU\ General\ Public\ License\ for\ more\ details.}}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00014}00014\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00015}00015\ \textcolor{comment}{You\ should\ have\ received\ a\ copy\ of\ the\ GNU\ General\ Public\ License}}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00016}00016\ \textcolor{comment}{along\ with\ this\ program.\ \ If\ not,\ see\ <https://www.gnu.org/licenses/>.}}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00017}00017\ \textcolor{comment}{*/}}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00018}00018\ }
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00019}00019\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{fileio_8h}{fileio/fileio.h}}>}}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00020}00020\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{global_8h}{global.h}}>}}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00021}00021\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{kio_8h}{io/kio.h}}>}}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00022}00022\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{nums_8h}{types/nums.h}}>}}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00023}00023\ }
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00025}\mbox{\hyperlink{_m_b_r_8c_aa35bad1e92008da628f27b2f6bb270aa}{00025}}\ \textcolor{preprocessor}{\#define\ SECTOR\_SIZE\ 512}}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00026}00026\ }
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00028}\mbox{\hyperlink{_m_b_r_8c_a4ed32bd4f78617ce362737f00fdc0b7b}{00028}}\ \textcolor{preprocessor}{\#define\ FAT16\_TYPE1\ 0x04}}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00029}00029\ }
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00031}\mbox{\hyperlink{_m_b_r_8c_a2c3746bbda6ed25630e65cef1f7f5831}{00031}}\ \textcolor{preprocessor}{\#define\ FAT16\_TYPE2\ 0x06}}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00032}00032\ }
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00037}\mbox{\hyperlink{struct_partition_entry}{00037}}\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{global_8h_a49f62b08b10c70ccf16f10ae9cd4add6}{PKG}}\ \mbox{\hyperlink{struct_partition_entry}{PartitionEntry}}\ \{}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00038}\mbox{\hyperlink{struct_partition_entry_ac8d01368991d9d2d46f9c6525af1cf8c}{00038}}\ \ \ \ \ \mbox{\hyperlink{nums_8h_aed742c436da53c1080638ce6ef7d13de}{u8}}\ \mbox{\hyperlink{struct_partition_entry_ac8d01368991d9d2d46f9c6525af1cf8c}{status}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00039}\mbox{\hyperlink{struct_partition_entry_abad2a389c6a992abf3e477dbbcf4273a}{00039}}\ \ \ \ \ \mbox{\hyperlink{nums_8h_aed742c436da53c1080638ce6ef7d13de}{u8}}\ \mbox{\hyperlink{struct_partition_entry_abad2a389c6a992abf3e477dbbcf4273a}{chs\_first}}[3];\ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00040}\mbox{\hyperlink{struct_partition_entry_a2cb1af2fc30ac789c9e989d57d2216df}{00040}}\ \ \ \ \ \mbox{\hyperlink{nums_8h_aed742c436da53c1080638ce6ef7d13de}{u8}}\ \mbox{\hyperlink{struct_partition_entry_a2cb1af2fc30ac789c9e989d57d2216df}{type}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00041}\mbox{\hyperlink{struct_partition_entry_af6f558369f04c73543318791ad4b7b49}{00041}}\ \ \ \ \ \mbox{\hyperlink{nums_8h_aed742c436da53c1080638ce6ef7d13de}{u8}}\ \mbox{\hyperlink{struct_partition_entry_af6f558369f04c73543318791ad4b7b49}{chs\_last}}[3];\ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00042}\mbox{\hyperlink{struct_partition_entry_ac54f5fe37c5eda7e5d477883dbdbd9c7}{00042}}\ \ \ \ \ \mbox{\hyperlink{nums_8h_a10e94b422ef0c20dcdec20d31a1f5049}{u32}}\ \mbox{\hyperlink{struct_partition_entry_ac54f5fe37c5eda7e5d477883dbdbd9c7}{lba\_first\_sector}};\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00043}\mbox{\hyperlink{struct_partition_entry_ab782f7d5ecd8e90dc9240882d4f216b0}{00043}}\ \ \ \ \ \mbox{\hyperlink{nums_8h_a10e94b422ef0c20dcdec20d31a1f5049}{u32}}\ \mbox{\hyperlink{struct_partition_entry_ab782f7d5ecd8e90dc9240882d4f216b0}{total\_sectors}};\ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00044}00044\ \};}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00045}00045\ }
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00050}\mbox{\hyperlink{struct_m_b_r}{00050}}\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{global_8h_a49f62b08b10c70ccf16f10ae9cd4add6}{PKG}}\ \mbox{\hyperlink{struct_m_b_r}{MBR}}\ \{}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00051}\mbox{\hyperlink{struct_m_b_r_af09cbcfefd6e4dbb9cf53b48f96f5f72}{00051}}\ \ \ \ \ \mbox{\hyperlink{nums_8h_aed742c436da53c1080638ce6ef7d13de}{u8}}\ \mbox{\hyperlink{struct_m_b_r_af09cbcfefd6e4dbb9cf53b48f96f5f72}{bootstrap}}[446];\ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00052}\mbox{\hyperlink{struct_m_b_r_a259c5eea62328410a413ec1929356163}{00052}}\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{struct_partition_entry}{PartitionEntry}}\ \mbox{\hyperlink{struct_m_b_r_a259c5eea62328410a413ec1929356163}{partitions}}[4];\ }
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00053}\mbox{\hyperlink{struct_m_b_r_a1a8e5ce3031355c8a44cbe9186397d18}{00053}}\ \ \ \ \ \mbox{\hyperlink{nums_8h_a9e6c91d77e24643b888dbd1a1a590054}{u16}}\ \mbox{\hyperlink{struct_m_b_r_a1a8e5ce3031355c8a44cbe9186397d18}{signature}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00054}00054\ \};}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00055}00055\ }
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00057}\mbox{\hyperlink{_m_b_r_8c_a64cdbe42e79baf07e056213647a512a0}{00057}}\ \mbox{\hyperlink{nums_8h_aed742c436da53c1080638ce6ef7d13de}{u8}}\ \mbox{\hyperlink{_m_b_r_8c_a64cdbe42e79baf07e056213647a512a0}{sector}}[\mbox{\hyperlink{_m_b_r_8c_aa35bad1e92008da628f27b2f6bb270aa}{SECTOR\_SIZE}}];}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00058}00058\ }
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00069}\mbox{\hyperlink{fileio_8h_a83c6766aaf545016943897b8f8902a98}{00069}}\ \mbox{\hyperlink{nums_8h_a10e94b422ef0c20dcdec20d31a1f5049}{u32}}\ \mbox{\hyperlink{_m_b_r_8c_a577272db0c7e551ce4486fbb640ab149}{FindFat16Partition}}()\ \{}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00070}00070\ \ \ \ \ \mbox{\hyperlink{_a_t_a_8c_a6c22a78fa6a488041bb15afa10a26137}{AtaReadSector}}(0,\ \mbox{\hyperlink{_m_b_r_8c_a64cdbe42e79baf07e056213647a512a0}{sector}});}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00071}00071\ \ \ \ \ \mbox{\hyperlink{kio_8h_a556dbaca28768fd91dacd53422223230}{Kprintf}}(\textcolor{stringliteral}{"{}Read\ ATA\ Sector\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00072}00072\ }
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00073}00073\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{struct_m_b_r}{MBR}}\ *mbr\ =\ (\textcolor{keyword}{struct\ }\mbox{\hyperlink{struct_m_b_r}{MBR}}\ *)\mbox{\hyperlink{_m_b_r_8c_a64cdbe42e79baf07e056213647a512a0}{sector}};}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00074}00074\ }
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00075}00075\ \ \ \ \ \textcolor{keywordflow}{if}\ (mbr-\/>\mbox{\hyperlink{struct_m_b_r_a1a8e5ce3031355c8a44cbe9186397d18}{signature}}\ !=\ 0xAA55)\ \{}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00076}00076\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;\ }
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00077}00077\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00078}00078\ }
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00079}00079\ \ \ \ \ \mbox{\hyperlink{kio_8h_a556dbaca28768fd91dacd53422223230}{Kprintf}}(\textcolor{stringliteral}{"{}Valid\ MBR\ Signature\ 0xAA55\ Detected\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00080}00080\ }
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00081}00081\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 4;\ i++)\ \{}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00082}00082\ \ \ \ \ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{struct_partition_entry}{PartitionEntry}}\ *part\ =\ \&mbr-\/>\mbox{\hyperlink{struct_m_b_r_a259c5eea62328410a413ec1929356163}{partitions}}[i];}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00083}00083\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{kio_8h_a556dbaca28768fd91dacd53422223230}{Kprintf}}(\textcolor{stringliteral}{"{}Partition\ type:\ 0x\%x\ \%x\(\backslash\)n"{}},\ i,\ part-\/>\mbox{\hyperlink{struct_partition_entry_a2cb1af2fc30ac789c9e989d57d2216df}{type}});}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00084}00084\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{kio_8h_a556dbaca28768fd91dacd53422223230}{Kprintf}}(\textcolor{stringliteral}{"{},\ LBA\ start:\ \%x\(\backslash\)n"{}},\ part-\/>\mbox{\hyperlink{struct_partition_entry_ac54f5fe37c5eda7e5d477883dbdbd9c7}{lba\_first\_sector}});}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00085}00085\ }
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00086}00086\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{kio_8h_a556dbaca28768fd91dacd53422223230}{Kprintf}}(\textcolor{stringliteral}{"{}Partition\ dump:\ \%x"{}},\ i);}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00087}00087\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ b\ =\ 0;\ b\ <\ (int)\textcolor{keyword}{sizeof}(\textcolor{keyword}{struct\ }\mbox{\hyperlink{struct_partition_entry}{PartitionEntry}});\ b++)\ \{}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00088}00088\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{kio_8h_adff30c0a071f02dbf33d53ecef9535ed}{KprintHex}}(((\mbox{\hyperlink{nums_8h_aed742c436da53c1080638ce6ef7d13de}{u8}}\ *)part)[b]);}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00089}00089\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{kio_8h_af05ef766e47691675bd907cbd362e7c5}{Kputchar}}(\textcolor{charliteral}{'\ '});}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00090}00090\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00091}00091\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{kio_8h_af05ef766e47691675bd907cbd362e7c5}{Kputchar}}(\textcolor{charliteral}{'\(\backslash\)n'});}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00092}00092\ }
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00093}00093\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (part-\/>\mbox{\hyperlink{struct_partition_entry_a2cb1af2fc30ac789c9e989d57d2216df}{type}}\ ==\ \mbox{\hyperlink{_m_b_r_8c_a4ed32bd4f78617ce362737f00fdc0b7b}{FAT16\_TYPE1}}\ ||\ part-\/>\mbox{\hyperlink{struct_partition_entry_a2cb1af2fc30ac789c9e989d57d2216df}{type}}\ ==\ \mbox{\hyperlink{_m_b_r_8c_a2c3746bbda6ed25630e65cef1f7f5831}{FAT16\_TYPE2}})\ \{}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00094}00094\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ part-\/>\mbox{\hyperlink{struct_partition_entry_ac54f5fe37c5eda7e5d477883dbdbd9c7}{lba\_first\_sector}};\ }
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00095}00095\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00096}00096\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00097}00097\ }
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00098}00098\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;\ }
\DoxyCodeLine{\Hypertarget{_m_b_r_8c_source_l00099}00099\ \}}

\end{DoxyCode}
